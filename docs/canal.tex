% pdflatex canal.tex
\documentclass[a4paper]{book}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage[usenames,dvipsnames]{xcolor}
\usepackage{a4wide}
\usepackage{makeidx}
\usepackage{hyperref}
\usepackage{fullpage}
\usepackage{graphicx}
\usepackage{fancybox}
\usepackage{import}
\usepackage{multicol}
\usepackage{float}
\usepackage{listings}
\usepackage{alltt}
\usepackage{times}
\usepackage{ifpdf}
\RequirePackage{array}
\RequirePackage{calc}

\makeindex

\lstset{language=C++,inputencoding=utf8,basicstyle=\footnotesize,breaklines=true,breakatwhitespace=true,tabsize=4,numbers=left}

% Generic environment used by all paragraph-based environments defined
% below. Note that the command \title{...} needs to be defined inside
% those environments!
\newenvironment{DoxyDesc}[1]{%
  \begin{list}{}%
  {%
    \settowidth{\labelwidth}{40pt}%
    \setlength{\leftmargin}{\labelwidth}%
    \setlength{\parsep}{0pt}%
    \setlength{\itemsep}{-4pt}%
    \renewcommand{\makelabel}{\entrylabel}%
  }%
  \item[#1:]}
{\end{list}}

% Used by <pre> ... </pre>
\newenvironment{DoxyPre}{%
  \small%
  \begin{alltt}%
}{%
  \end{alltt}%
  \normalsize%
}

% Used by @code ... @endcode
\newenvironment{DoxyCode}{%
  \footnotesize%
  \verbatim%
}{%
  \endverbatim%
  \normalsize%
}

% Used by @example, @include, @includelineno and @dontinclude
\newenvironment{DoxyCodeInclude}{%
  \DoxyCode%
}{%
  \endDoxyCode%
}

% Used by @verbatim ... @endverbatim
\newenvironment{DoxyVerb}{%
  \footnotesize%
  \verbatim%
}{%
  \endverbatim%
  \normalsize%
}

% Used by @verbinclude
\newenvironment{DoxyVerbInclude}{%
  \DoxyVerb%
}{%
  \endDoxyVerb%
}

% Used by numbered lists (using '-#' or <ol> ... </ol>)
\newenvironment{DoxyEnumerate}{%
  \enumerate%
}{%
  \endenumerate%
}

% Used by bullet lists (using '-', @li, @arg, or <ul> ... </ul>)
\newenvironment{DoxyItemize}{%
  \itemize%
}{%
  \enditemize%
}

% Used by description lists (using <dl> ... </dl>)
\newenvironment{DoxyDescription}{%
  \description%
}{%
  \enddescription%
}

% Used by @image, @dotfile, and @dot ... @enddot
% (only if caption is specified)
\newenvironment{DoxyImage}{%
  \begin{figure}[H]%
  \begin{center}%
}{%
  \end{center}%
  \end{figure}%
}

% Used by @image, @dotfile, @dot ... @enddot, and @msc ... @endmsc
% (only if no caption is specified)
\newenvironment{DoxyImageNoCaption}{%
}{%
}

% Used by @attention
\newenvironment{DoxyAttention}[1]{%
  \begin{DoxyDesc}{#1}%
}{%
  \end{DoxyDesc}%
}

% Used by @author and @authors
\newenvironment{DoxyAuthor}[1]{%
  \begin{DoxyDesc}{#1}%
}{%
  \end{DoxyDesc}%
}

% Used by @date
\newenvironment{DoxyDate}[1]{%
  \begin{DoxyDesc}{#1}%
}{%
  \end{DoxyDesc}%
}

% Used by @invariant
\newenvironment{DoxyInvariant}[1]{%
  \begin{DoxyDesc}{#1}%
}{%
  \end{DoxyDesc}%
}

% Used by @note
\newenvironment{DoxyNote}[1]{%
  \begin{DoxyDesc}{#1}%
}{%
  \end{DoxyDesc}%
}

% Used by @post
\newenvironment{DoxyPostcond}[1]{%
  \begin{DoxyDesc}{#1}%
}{%
  \end{DoxyDesc}%
}

% Used by @pre
\newenvironment{DoxyPrecond}[1]{%
  \begin{DoxyDesc}{#1}%
}{%
  \end{DoxyDesc}%
}

% Used by @remark
\newenvironment{DoxyRemark}[1]{%
  \begin{DoxyDesc}{#1}%
}{%
  \end{DoxyDesc}%
}

% Used by @return
\newenvironment{DoxyReturn}[1]{%
  \begin{DoxyDesc}{#1}%
}{%
  \end{DoxyDesc}%
}

% Used by @since
\newenvironment{DoxySince}[1]{%
  \begin{DoxyDesc}{#1}%
}{%
  \end{DoxyDesc}%
}

% Used by @see
\newenvironment{DoxySeeAlso}[1]{%
  \begin{DoxyDesc}{#1}%
}{%
  \end{DoxyDesc}%
}

% Used by @version
\newenvironment{DoxyVersion}[1]{%
  \begin{DoxyDesc}{#1}%
}{%
  \end{DoxyDesc}%
}

% Used by @warning
\newenvironment{DoxyWarning}[1]{%
  \begin{DoxyDesc}{#1}%
}{%
  \end{DoxyDesc}%
}

% Used by @internal
\newenvironment{DoxyInternal}[1]{%
  \begin{DoxyDesc}{#1}%
}{%
  \end{DoxyDesc}%
}

% Used by @par and @paragraph
\newenvironment{DoxyParagraph}[1]{%
  \begin{list}{}%
  {%
    \settowidth{\labelwidth}{40pt}%
    \setlength{\leftmargin}{\labelwidth}%
    \setlength{\parsep}{0pt}%
    \setlength{\itemsep}{-4pt}%
    \renewcommand{\makelabel}{\entrylabel}%
  }%
  \item[#1]%
}{%
  \end{list}%
}

% Used by parameter lists
\newenvironment{DoxyParams}[1]{%
  \begin{DoxyDesc}{#1}%
    \begin{description}%
}{%
    \end{description}%
  \end{DoxyDesc}%
}

% Used by return value lists
\newenvironment{DoxyRetVals}[1]{%
  \begin{DoxyDesc}{#1}%
    \begin{description}%
}{%
    \end{description}%
  \end{DoxyDesc}%
}

% Used by exception lists
\newenvironment{DoxyExceptions}[1]{%
  \begin{DoxyDesc}{#1}%
    \begin{description}%
}{%
    \end{description}%
  \end{DoxyDesc}%
}

% Used by template parameter lists
\newenvironment{DoxyTemplParams}[1]{%
  \begin{DoxyDesc}{#1}%
    \begin{description}%
}{%
    \end{description}%
  \end{DoxyDesc}%
}

\newcommand{\doxyref}[3]{\textbf{#1} (\textnormal{#2}\,\pageref{#3})}

\newenvironment{DoxyCompactList}%
{\begin{list}{}{%
  \setlength{\leftmargin}{0.5cm}%
  \setlength{\itemsep}{0pt}%
  \setlength{\parsep}{0pt}%
  \setlength{\topsep}{0pt}%
  \renewcommand{\makelabel}{\hfill}}}%
{\end{list}}

\newenvironment{DoxyCompactItemize}%
{\begin{itemize}%
  \setlength{\itemsep}{-3pt}%
  \setlength{\parsep}{0pt}%
  \setlength{\topsep}{0pt}%
  \setlength{\partopsep}{0pt}}%
{\end{itemize}}

\newcommand{\PBS}[1]{\let\temp=\\#1\let\\=\temp}

\newlength{\tmplength}

\newenvironment{TabularC}[1]
{
\setlength{\tmplength}
     {\linewidth/(#1)-\tabcolsep*2-\arrayrulewidth*(#1+1)/(#1)}
      \par\begin{tabular*}{\linewidth}
             {*{#1}{|>{\PBS\raggedright\hspace{0pt}}p{\the\tmplength}}|}
}
{\end{tabular*}\par}

\newcommand{\entrylabel}[1]{
   {\parbox[b]{\labelwidth-4pt}{\makebox[0pt][l]{\textbf{#1}}\vspace{1.5\baselineskip}}}}

\newenvironment{Desc}
{\begin{list}{}%
  {%
    \settowidth{\labelwidth}{40pt}%
    \setlength{\leftmargin}{\labelwidth}%
    \setlength{\parsep}{0pt}%
    \setlength{\itemsep}{-4pt}%
    \renewcommand{\makelabel}{\entrylabel}%
  }%
}
{\end{list}}

\newenvironment{Indent}
  {\begin{list}{}{\setlength{\leftmargin}{0.5cm}}
      \item[]\ignorespaces}
  {\unskip\end{list}}

\definecolor{comment}{rgb}{0.5,0.0,0.0}
\definecolor{keyword}{rgb}{0.0,0.5,0.0}
\definecolor{keywordtype}{rgb}{0.38,0.25,0.125}
\definecolor{keywordflow}{rgb}{0.88,0.5,0.0}
\definecolor{preprocessor}{rgb}{0.5,0.38,0.125}
\definecolor{stringliteral}{rgb}{0.0,0.125,0.25}
\definecolor{charliteral}{rgb}{0.0,0.5,0.5}
\definecolor{vhdldigit}{rgb}{1.0,0.0,1.0}
\definecolor{vhdlkeyword}{rgb}{0.43,0.0,0.43}
\definecolor{vhdllogic}{rgb}{1.0,0.0,0.0}
\definecolor{vhdlchar}{rgb}{0.0,0.0,0.0}


\title{Canal\\
\vskip 1em
\large{a static code analysis tool}}
\author{Karel Klíč}

\begin{document}
\maketitle

\tableofcontents

\cleardoublepage

\chapter{Overview}

Canal is a tool supporting the development of static code analysis
techniques that increase the understandability, traceability, or
correctness of computer programs.

Canal can also be used to analyze the behaviour of real-world computer
programs written in C and C++ languages.  Canal is written on the top
of LLVM compiler framework and uses the LLVM intermediate
representation to analyze programs.

The Abstract Interpretation framework is used as a base for the
embedded static analysis algorithms.

\section{Use cases}
\subsection{Analysis of program behaviour}
You can hook on the fixpoint of function calls to inspect the
calculated abstract values.  You can get abstract values of function
call parameters.

\subsection{Comparison with a specification}
A set of pre- and post-conditions for functions, and variable-based or
module-based automata.  This can be defined for certain function or
library, and library/function users are watched to conform to the
specification.

\subsection{Conformance to environment constraints}
Double free, memory leaks, buffer overflow and underflow, division by
zero, invalid access to memory, locking and concurrency errors,
uncaught exceptions.

\section{Artifacts}
\subsection{Source code}
\subsection{Specification}
\subsection{Models}

\part{Concepts}

\chapter{Abstract Interpretation}
Our abstract interpreter comes in four flavours:
\begin{description}
\item[Context-insensitive flow-insensitive] For every function in a
  program, the fixpoint is calculated with a single set of abstract
  values that encompasses all function calls.
\item[Context-insensitive flow-sensitive] For every function in a
  program, the fixpoint is calculated with a single set of abstract
  values that encompasses all function calls, but every possible path
  through the function is calculated separately.
\item[Context-sensitive flow-insensitive] The fixpoint is calculated
  with a set of abstract values specifically created for every
  function call.
\item[Context-sensitive flow-sensitive] The fixpoint is calculated
  with a set of abstract values specifically created for every
  possible path in a function call.  Path conditions are taken into
  account.
\end{description}

Abstract interpreter can be either operational or equation-based.  Our
interpreter is operational.

\subsection{Tuning}
The precision of abstract interpreter is greately tunable. Here are
the aspects to consider:
\begin{description}
\item[Interpreter flavour] Context-sensitivity and flow-sensitivity
  increase both precision and complexity.
\item[Widening and narrowing] Selection and parameters of widening and
  narrowing operators affect both precision and complexity.
\item[Relations in abstract domains] Type and number of relations in
  abstract domains affect both precision and complexity.
\item[Memory for abstract domains] Parameters of some abstract domains
  allow to trade memory for better precision.
\end{description}

Maximal precision of abstract interpreter is same as for symbolic
executor, but abstract interpreter is more tunable.

\subsection{Context sensitivity}
Context sensitivity is achieved by keeping a function call stack.
Every stack frame keeps the complete state of a function fixpoint
calculation (all local and global variables).  When a function call is
reached during the fixpoint computation and function call parameters
are already initialized, a new frame is placed on the top of stack and
the called function is interpreted with the provided parameters.

\subsection{Flow sensitivity}


\chapter{Abstractions}

\section{Memory}
Our memory abstraction for abstract interpretation recognizes four
kinds of memory:
\begin{description}
\item[Register-like stack memory] This is function-level memory that
  is released automatically when function returns.  We denote such a
  memory by LLVM-style names starting with the percent sign
  \texttt{\%}.  Memory either has a name (e.g. \texttt{\%result}) or a
  number is generated to serve as a name (e.g. \texttt{\%32} denotes
  thirty-second unnamed instruction call in a function).
\item[Stack memory allocated by \texttt{alloca}] This is also a
  function-level memory that is released automatically when function
  returns.  The difference to register-like stack memory is that this
  memory is accessed by LLVM exclusively via pointers.  We denote such
  a memory by names starting with \texttt{\%\^}.  Every piece of
  memory has a name corresponding to the place where the memory has
  been allocated (\texttt{alloca} has been called).  So if the memory
  has been allocated by an instruction call \texttt{\%ptr = alloca
    i32, align 4}, it can be denoted by \texttt{\%\^{}ptr}.
\item[Global variables] Global variables are module-wise and are valid
  for the whole program run.  We denote such a memory by LLVM-style
  names starting with \texttt{@}.
\item[Heap memory] Heap memory is also valid for the whole program
  run.  We denote such a memory by names starting by \texttt{@\^}.
  Every piece of memory has a name corresponding to the place where
  the memory has been allocated (\texttt{malloc} or similar function
  has been called).  Name of the function is also included in the
  place name, so if a function \texttt{createString} contains an
  instruction call \texttt{\%result = call i8* @malloc(i32 1)}, we can
  denote the memory allocated on this place by
  \texttt{@\^{}createString:result}.
\end{description}

As it can be seen from the style of memory denotation, every piece of
memory is associated with a place in the program.  This means all
operations affecting a memory block allocated at certain place forms a
single abstract value.  Context-sensite abstract interpretation helps
to increase the precision of this memory abstraction.

\section{Arrays}

\section{Structures}

\section{Integers}

\section{Floating-point numbers}

\section{Pointers}
Pointer can be casted to a number via the \texttt{ptrtoint}
instruction.  Usually, the resulting memory offset is used to achieve
pointer arithmetics that are not available via \texttt{getelementptr}
semantics.

\chapter{Wishlist}
\begin{description}
\item[Lazy model-checking abstract value] Allow to investigate just a
  single function, taking into account all possible parameter values
  and shapes (perhaps limited by a pre-condition).  Parameter values
  and shapes must be smartly provided depending on the boundary
  requirements of the checked code.  This allows a kind of model
  checking, and use of model checking algorithms and ideas.
\item[Widening operators] Implement widening operators for integers
  and other abstract domains as required.
\item[Narrowing operators] Implement narrowing operators for integers
  and other abstract domains as required.
\item[String abstractions] Implement abstract domains specific for C
  strings.
\item[Weakly relational numeric abstractions] Implement weakly
  relational integer and floating-point abstract domains.
\item[Basic block abstraction] Implement basic block summaries that
  speed-up the static analysis.
\item[Function abstraction] Implement function summaries that speed-up
  the static analysis.
\item[Parallelization] Make abstract interpreter to use multiple
  threads for fixpoint calculation on the right level.
\item[Concurrency check] Add support for checking of multi-threaded
  programs.
\end{description}

\part{Implementation}

\chapter{Overview}

Canal is implemented in the C++ language as defined in the C++98
standard (ISO/IEC 14882:1998).  It uses the C++ standard library as
well as some additional libraries:
\begin{itemize}
\item LLVM core libraries.  All versions from 2.8 up to 3.1 are
  supported.
\item Clang compiler.  All versions from 2.8 up to 3.1 are
  supported.
\item GNU readline or any of its BSD-licensed reimplementation.
\item elfutils; this library is optional, and used only on
  Linux-based operating systems
\end{itemize}

\chapter{Installation}

%\section{Installation from source code on Microsoft Windows XP}

%\section{Installation from source code on Mac OS X}

%\section{Installation from source code on Ubuntu 12.04}

%Canal can be built and installed on Ubuntu 12.04.

\section{Installation from source code on Red Hat Enterprise Linux 6}

Canal can be built and installed on Red Hat Enterprise Linux 6, but
some additional packages must be installed from third-party
repositories prior to building it.  Documentation can be build on Red
Hat Eneterprise Linux 6 as well.

Packages required by the build process:
\begin{itemize}
\item The core library requires \texttt{llvm-devel} and \texttt{clang}
  packages, which can be obtained from Extra Packages for Enterprise
  Linux (or EPEL) software repository.
\item The command-line user interface tool requires
  \texttt{elfutils-devel}and \texttt{readline-devel} packages.
\item The documentation requires \texttt{doxygen},
  \texttt{texlive-collection-basic}, \texttt{texlive-import},
  \texttt{texlive-preprint}, \texttt{texlive-fullpage},
  \texttt{texlive-a4wide}, \texttt{texlive-epstopdf} packages.  The
  \texttt{texlive-*} packages can be obtained from Jindřich Nový's
  TeXLive software repository, which is available at
  \url{http://jnovy.fedorapeople.org/texlive/packages.el6/}.
\end{itemize}

The installed program requires \texttt{llvm}, \texttt{clang},
\texttt{elfutils}, \texttt{readline} packages.

\import{doxygen-canal/}{refman}

\cleardoublepage
\addcontentsline{toc}{chapter}{Bibliography}
\begin{thebibliography}{9}

\bibitem{lamport94}
  Leslie Lamport,
  \emph{\LaTeX: A Document Preparation System}.
  Addison Wesley, Massachusetts,
  2nd Edition,
  1994.

\end{thebibliography}

\clearpage
\addcontentsline{toc}{chapter}{Index}
\printindex

\end{document}
